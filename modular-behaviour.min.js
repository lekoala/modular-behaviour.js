var o="modular-behaviour",f=0,r={},a=0,u=null,h=()=>{s.scanWatchList()||(a<100?a+=10:a+=100,a<2e3?u=setTimeout(h,a):(console.warn(`Unable to load ${s.watching().join(",")}`),r={},u=null))};window.addEventListener("DOMContentLoaded",()=>{s.scanWatchList()});var s=class extends HTMLElement{constructor(){super(),f++}set name(t){this.setAttribute("name",t)}get name(){return this.getAttribute("name")}set selector(t){this.setAttribute("selector",t)}get selector(){return this.getAttribute("selector")}set func(t){this.setAttribute("func",t)}get func(){return this.getAttribute("func")}set config(t){this.setAttribute("config",t)}get config(){return this.getAttribute("config")}set manual(t){t?this.setAttribute("manual",""):this.removeAttribute("manual")}get manual(){return this.hasAttribute("manual")}loadConfigTemplate(t){let e=document.createElement("script");e.textContent=t.content.textContent,this.appendChild(e)}resolveConfig(t={}){return this.config&&(t=s.globalValue(this.config),t||(console.warn(`${this.config} is not available`),t={}),typeof t=="function"&&(t=t())),t=Object.assign(t,this.dataset),t}static globalValue(t){if(!t)return null;if(t.includes(".")){let e=t.split("."),i=e[0],n=e[1],l=window[i];return l?(i==="$"||i==="jQuery")&&typeof window.jQuery.fn[n]<"u"?(c,d)=>{window.jQuery.fn[n].call(window.jQuery(c),d)}:l[n]||null:void 0}return window[t]||null}static watch(t,e){let i=document.querySelector(`script[provides="${t}"]`);if(i){let n=i.onload;i.onload=l=>{n&&n(l);let c=s.globalValue(t);c&&e(c)};return}r[t]||(r[t]=[]),r[t].push(e),a=10,u||h()}static scanWatchList(){for(var t in r){let i=s.globalValue(t);if(i){for(var e of r[t])e(i);delete r[t]}}return Object.keys(r).length?!1:(u&&(clearTimeout(u),u=null),!0)}static run(t){let e=s.globalValue(t);return e?(document.querySelectorAll(`modular-behaviour[name="${t}"]`).forEach(i=>{i.classList.contains(`${o}-initialized`)||i.init(e)}),!0):!1}static watching(){return Object.keys(r)}static isConstructable(t){try{return new new Proxy(t,{construct:()=>({})}),!0}catch{return!1}}init(t){let e=this.querySelector(`template.${o}-config`),i={};e&&(this.config?this.loadConfigTemplate(e):i=JSON.parse(e.content.textContent));let n=this.selector?this.querySelector(this.selector):this.firstElementChild;if(!n){console.warn("No element");return}if(n.hasAttribute("id")||n.setAttribute("id",`${o}-${f}`),this.func&&(t=s.globalValue(this.func),!t)){console.warn(`${this.func} is not available`);return}let l=s.isConstructable(t),c;l?new t(n,this.resolveConfig(i)):(Object.create(t.prototype||t),t.apply(c,[n,this.resolveConfig(i)])),this.classList.remove(`${o}-pending`),this.classList.add(`${o}-initialized`)}connectedCallback(){let t=s.globalValue(this.name);if(!t){if(this.classList.add(`${o}-pending`),this.manual)return;s.watch(this.name,e=>{this.init(e)});return}this.init(t)}};customElements.define("modular-behaviour",s);var g=s;export{g as default};
//# sourceMappingURL=modular-behaviour.min.js.map
