function d(i){if(i==="true")return!0;if(i==="false")return!1;if(i===""||i==="null")return null;if(i===Number(i).toString())return Number(i);if(i.indexOf("[")===0||i.indexOf("{")===0)try{return i.indexOf('"')===-1&&(i=i.replaceAll("'",'"')),JSON.parse(decodeURIComponent(i))}catch{return console.log("Failed to parse "+i),{}}return i}function u(i){if(!i)return null;if(i.includes(".")){let t=i.split("."),e=t[0],n=t[1],s=window[e];return s?(e==="$"||e==="jQuery")&&typeof window.jQuery.fn[n]<"u"?(h,l)=>{window.jQuery.fn[n].call(window.jQuery(h),l)}:s[n]||null:void 0}return window[i]||null}function m(i){try{return new new Proxy(i,{construct:()=>({})}),!0}catch{return!1}}var c="modular-behaviour",p=0,r={},a=0,f=null,b=()=>{o.scanWatchList()||(a<100?a+=10:a+=100,a<2e3?f=setTimeout(b,a):(console.warn(`Unable to load ${o.watching().join(",")}`),r={},f=null))},g=new window.IntersectionObserver((i,t)=>{i.forEach(async e=>{e.isIntersecting&&(t.unobserve(e.target),e.target.onConnect())})});window.addEventListener("DOMContentLoaded",()=>{o.scanWatchList()});var o=class extends HTMLElement{constructor(){super(),p++}set name(t){this.setAttribute("name",t)}get name(){return this.getAttribute("name")}set selector(t){this.setAttribute("selector",t)}get selector(){return this.getAttribute("selector")}set func(t){this.setAttribute("func",t)}get func(){return this.getAttribute("func")}set config(t){this.setAttribute("config",t)}get config(){return this.getAttribute("config")}set src(t){this.setAttribute("src",t)}get src(){return this.getAttribute("src")}set manual(t){t?this.setAttribute("manual",""):this.removeAttribute("manual")}get manual(){return this.hasAttribute("manual")}set lazy(t){t?this.setAttribute("lazy",""):this.removeAttribute("lazy")}get lazy(){return this.hasAttribute("lazy")}loadConfigTemplate(t){let e=document.createElement("script");e.textContent=t.content.textContent,this.appendChild(e)}resolveConfig(t={}){this.config&&(t=u(this.config),t||(console.warn(`${this.config} is not available`),t={}),typeof t=="function"&&(t=t()));let e={...this.dataset};for(var n in e)t[n]=d(e[n]);return t}static watch(t,e){let n=document.querySelector(`script[provides="${t}"]`);if(n){let s=n.onload;n.onload=h=>{s&&s(h);let l=u(t);l&&e(l)};return}r[t]||(r[t]=[]),r[t].push(e),a=10,f||b()}static scanWatchList(){for(var t in r){let n=u(t);if(n){for(var e of r[t])e(n);delete r[t]}}return Object.keys(r).length?!1:(f&&(clearTimeout(f),f=null),!0)}static run(t){let e=u(t);return e?(document.querySelectorAll(`modular-behaviour[name="${t}"]`).forEach(n=>{n.classList.contains(`${c}-initialized`)||n.init(e)}),!0):!1}static watching(){return Object.keys(r)}init(t){let e=this.querySelector(`template.${c}-config`),n={};e&&(this.config?this.loadConfigTemplate(e):n=JSON.parse(e.content.textContent));let s=this.selector?this.querySelector(this.selector):this.firstElementChild;if(!s){console.warn("No element");return}if(s.hasAttribute("id")||s.setAttribute("id",`${c}-${p}`),this.func&&(t=u(this.func),!t)){console.warn(`${this.func} is not available`);return}if(m(t))new t(s,this.resolveConfig(n));else{let l=Object.create(t.prototype||t);t.apply(l,[s,this.resolveConfig(n)])}this.classList.remove(`${c}-pending`),this.classList.add(`${c}-initialized`)}async onConnect(){let t;if(this.src?t=(await import(this.src)).default:t=u(this.name),!t){if(this.classList.add(`${c}-pending`),this.manual)return;o.watch(this.name,e=>{this.init(e)});return}this.init(t)}connectedCallback(){if(this.lazy){g.observe(this);return}this.onConnect()}};customElements.define("modular-behaviour",o);var L=o;export{L as default};
//# sourceMappingURL=modular-behaviour.min.js.map
