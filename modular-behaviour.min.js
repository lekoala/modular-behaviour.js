var a="modular-behaviour",f=0,r={},u=null,l=0,i=class extends HTMLElement{constructor(){super(),f++}set name(t){this.setAttribute("name",t)}get name(){return this.getAttribute("name")}set selector(t){this.setAttribute("selector",t)}get selector(){return this.getAttribute("selector")}set func(t){this.setAttribute("func",t)}get func(){return this.getAttribute("func")}set config(t){this.setAttribute("config",t)}get config(){return this.getAttribute("config")}set manual(t){t?this.setAttribute("manual",""):this.removeAttribute("manual")}get manual(){return this.hasAttribute("manual")}set jsonconfig(t){t?this.setAttribute("jsonconfig",""):this.removeAttribute("jsonconfig")}get jsonconfig(){return this.hasAttribute("jsonconfig")}loadConfigTemplate(t){let e=document.createElement("script");e.textContent=t.content.textContent,this.appendChild(e)}resolveConfig(t={}){return this.config&&(t=i.globalValue(this.config),t||(console.warn(`${this.config} is not available`),t={}),typeof t=="function"&&(t=t())),t=Object.assign(t,this.dataset),t}static globalValue(t){if(!t)return null;if(t.includes(".")){let e=t.split("."),s=e[0],n=e[1],o=window[s];return o?(s==="$"||s==="jQuery")&&typeof window.jQuery.fn[n]<"u"?(c,h)=>{window.jQuery.fn[n].call(window.jQuery(c),h)}:o[n]||null:void 0}return window[t]||null}static watch(t,e){let s=document.querySelector(`script[provides="${t}"]`);if(s){let n=s.onload;s.onload=o=>{n&&n(o);let c=i.globalValue(t);c&&e(c)};return}r[t]||(r[t]=[]),r[t].push(e),l=10,u||(u=()=>{if(i.scanWatchList()){u=null;return}l<100?l+=10:l+=100,l<2e3?setTimeout(u,l):(console.warn(`Unable to load ${i.watching().join(",")}`),r={})},setTimeout(u,l))}static scanWatchList(){for(var t in r){let s=i.globalValue(t);if(s){for(var e of r[t])e(s);if(delete r[t],!Object.keys(r).length)return!0}}return!1}static run(t){let e=i.globalValue(t);return e?(document.querySelectorAll(`modular-behaviour[name="${t}"]`).forEach(s=>{s.classList.contains(`${a}-initialized`)||s.init(e)}),!0):!1}static watching(){return Object.keys(r)}static isConstructable(t){try{return new new Proxy(t,{construct:()=>({})}),!0}catch{return!1}}init(t){let e=this.querySelector(`template.${a}-config`),s={};e&&(this.jsonconfig?s=JSON.parse(e.content.textContent):this.loadConfigTemplate(e));let n=this.selector?this.querySelector(this.selector):this.firstElementChild;if(!n){console.warn("No element");return}if(n.hasAttribute("id")||n.setAttribute("id",`${a}-${f}`),this.func&&(t=i.globalValue(this.func),!t)){console.warn(`${this.func} is not available`);return}let o=i.isConstructable(t),c;o?new t(n,this.resolveConfig(s)):(Object.create(t.prototype||t),t.apply(c,[n,this.resolveConfig(s)])),this.classList.remove(`${a}-pending`),this.classList.add(`${a}-initialized`)}connectedCallback(){let t=i.globalValue(this.name);if(!t){if(this.classList.add(`${a}-pending`),this.manual)return;i.watch(this.name,e=>{this.init(e)});return}this.init(t)}};customElements.define("modular-behaviour",i);var g=i;export{g as default};
//# sourceMappingURL=modular-behaviour.min.js.map
