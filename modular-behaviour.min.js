(function(e){"use strict";function t(e,t){e.hasAttribute("async")||e.hasAttribute("nomodule")||(u++,e.onload=function(e){u--,u<=0&&(i("all scripts loaded"),f&&l.run())})}function r(e,t,r){var n;return r?n=e[r].apply(s,t):(n=Object.create(e.prototype),e.apply(n,t)),n}function n(e){"complete"===s.readyState||"loading"!==s.readyState&&!s.documentElement.doScroll?e():s.addEventListener("DOMContentLoaded",e)}function i(e){a.debug&&console.log("[mb] "+e)}function o(){return d++,"ModularBehaviour"+d.toString()}"undefined"==typeof jQuery&&"undefined"!=typeof require&&require.defined&&require.defined("jquery")&&(jQuery=require("jquery"));var s=e.document,a={attr:"data-mb",failedClass:"mb-failed",initClass:"mb-init",optionsKey:"options",maxTries:3,retryInterval:250,observeDom:!0,debug:!1},u=0,f=!1;s.querySelectorAll("script[src]").forEach(function(e){t(e)});var d=0,l={optionsTransformers:{},afterInitHooks:{},domObserver:null,init:function(e){var t=this;if(e)for(var r in e)this.setConfig(r,e[r]);u&&i(u+" scripts loading"),n(function(){t.run(),a.observeDom&&t.startObserver()})},startObserver:function(){var e=this;if(!e.domObserver){e.domObserver=new MutationObserver(function(r){for(var n=0;n<r.length;n++){var o=r[n];o.addedNodes.forEach(function(r){r.tagName&&!1!==r.isConnected&&("script"===r.tagName.toLowerCase()&&(i("Track new script"),t(r),f=!0),!f&&r.hasAttribute(a.attr)&&(i("Configure element for mutation"),e.configureElement(r)))})}});var r=s.documentElement||s.body;e.domObserver.observe(r,{subtree:!0,attributes:!1,childList:!0,characterData:!1}),i("Observing dom")}},stopObserver:function(){this.domObserver&&this.domObserver.disconnect()},getConfig:function(e){return a[e]},setConfig:function(e,t){a[e]=t},run:function(){if(u)return i("should run"),void(f=!0);i("run");for(var e=s.querySelectorAll("["+a.attr+"]"),t=0;t<e.length;t++)this.configureElement(e[t]);f=!1},addAfterInitHook:function(e,t){this.afterInitHooks[e]=t},removeAfterInitHook:function(e){delete this.afterInitHooks[e]},addOptionsTransformer:function(e,t){this.optionsTransformers[e]=t},removeOptionsTransformer:function(e){delete this.optionsTransformers[e]},parseOptions:function(t){if(!t||"undefined"===t)return{};if("string"==typeof t)if(0===t.indexOf("base64:")&&(t=atob(t.substring(7))),"#"===t.charAt(0)){var r=s.getElementById(t.substring(1));r&&"template"===r.tagName.toLowerCase()&&(r=r.content);var n=r&&r.textContent;n?t=JSON.parse(n):i("Config not found with selector "+t)}else if("()"===t.slice(-2)){var o=t.substring(0,t.length-2);o in e?t=e[o]():i("Config callback not found with name "+o)}else"{"===t.charAt(0)?(t=JSON.parse(t),t||i("Invalid config. Make sure it's properly JSON encoded.")):i("Weird config detected",t);return t},configureModule:function(t,n,o){var s,u=this,f=e,d=n,l=null;if(-1!==n.indexOf(".")){var c=n.split(".");f=e[c[0]],d=c[1]}if(-1!==d.indexOf(":")){var m=d.split(":");d=m[0],l=m[1]}if(f&&void 0!==f[d]?(i("Configuring js module "+n),s=r(f[d],[t,o],l)):"undefined"!=typeof jQuery&&void 0!==jQuery.fn[d]?(i("Configuring jQuery module "+n),s=jQuery.fn[d].call($(t),o)):(i("Undefined module "+n),t.classList.add(a.failedClass)),s)t.classList.remove(a.failedClass),t.classList.add(a.initClass),n in this.afterInitHooks&&this.afterInitHooks[n](s,t,o),i(n+" initialized");else{var p=t.getAttribute(a.attr+"-retries");p||(p=0),p<a.maxTries&&(p++,t.setAttribute(a.attr+"-retries",p),e.setTimeout(function(){i("try again for "+n),u.configureModule(t,n,o)},a.retryInterval))}},configureElement:function(e){if(e.classList.contains(a.initClass))i(e.getAttribute("id")+" is already initialized");else{e.getAttribute("id")||(i("an id has been set for an element"),e.setAttribute("id",o()));for(var t=e.getAttribute(a.attr).split(" "),r=0;r<t.length;r++){var n=t[r],s=e.getAttribute(a.attr+"-"+n+"-"+a.optionsKey);if(s||(s=e.getAttribute(a.attr+"-"+a.optionsKey)),s=this.parseOptions(s),n in this.optionsTransformers){var u=this.optionsTransformers[n](s,e);u&&(s=u)}this.configureModule(e,n,s)}}}};"function"==typeof define&&define.amd?define(function(){return l}):"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=l),exports.ModularBehaviour=l):e.ModularBehaviour=l})(this);