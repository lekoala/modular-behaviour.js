var c="modular-behaviour",h=0,r={},o=0,a=null,b=()=>{i.scanWatchList()||(o<100?o+=10:o+=100,o<2e3?a=setTimeout(b,o):(console.warn(`Unable to load ${i.watching().join(",")}`),r={},a=null))},g=new window.IntersectionObserver((f,t)=>{f.forEach(async e=>{e.isIntersecting&&(t.unobserve(e.target),e.target.onConnect())})});window.addEventListener("DOMContentLoaded",()=>{i.scanWatchList()});var i=class extends HTMLElement{constructor(){super(),h++}set name(t){this.setAttribute("name",t)}get name(){return this.getAttribute("name")}set selector(t){this.setAttribute("selector",t)}get selector(){return this.getAttribute("selector")}set func(t){this.setAttribute("func",t)}get func(){return this.getAttribute("func")}set config(t){this.setAttribute("config",t)}get config(){return this.getAttribute("config")}set src(t){this.setAttribute("src",t)}get src(){return this.getAttribute("src")}set manual(t){t?this.setAttribute("manual",""):this.removeAttribute("manual")}get manual(){return this.hasAttribute("manual")}set lazy(t){t?this.setAttribute("lazy",""):this.removeAttribute("lazy")}get lazy(){return this.hasAttribute("lazy")}loadConfigTemplate(t){let e=document.createElement("script");e.textContent=t.content.textContent,this.appendChild(e)}resolveConfig(t={}){return this.config&&(t=i.globalValue(this.config),t||(console.warn(`${this.config} is not available`),t={}),typeof t=="function"&&(t=t())),t=Object.assign(t,this.dataset),t}static globalValue(t){if(!t)return null;if(t.includes(".")){let e=t.split("."),s=e[0],n=e[1],u=window[s];return u?(s==="$"||s==="jQuery")&&typeof window.jQuery.fn[n]<"u"?(l,d)=>{window.jQuery.fn[n].call(window.jQuery(l),d)}:u[n]||null:void 0}return window[t]||null}static watch(t,e){let s=document.querySelector(`script[provides="${t}"]`);if(s){let n=s.onload;s.onload=u=>{n&&n(u);let l=i.globalValue(t);l&&e(l)};return}r[t]||(r[t]=[]),r[t].push(e),o=10,a||b()}static scanWatchList(){for(var t in r){let s=i.globalValue(t);if(s){for(var e of r[t])e(s);delete r[t]}}return Object.keys(r).length?!1:(a&&(clearTimeout(a),a=null),!0)}static run(t){let e=i.globalValue(t);return e?(document.querySelectorAll(`modular-behaviour[name="${t}"]`).forEach(s=>{s.classList.contains(`${c}-initialized`)||s.init(e)}),!0):!1}static watching(){return Object.keys(r)}static isConstructable(t){try{return new new Proxy(t,{construct:()=>({})}),!0}catch{return!1}}init(t){let e=this.querySelector(`template.${c}-config`),s={};e&&(this.config?this.loadConfigTemplate(e):s=JSON.parse(e.content.textContent));let n=this.selector?this.querySelector(this.selector):this.firstElementChild;if(!n){console.warn("No element");return}if(n.hasAttribute("id")||n.setAttribute("id",`${c}-${h}`),this.func&&(t=i.globalValue(this.func),!t)){console.warn(`${this.func} is not available`);return}if(i.isConstructable(t))new t(n,this.resolveConfig(s));else{let l=Object.create(t.prototype||t);t.apply(l,[n,this.resolveConfig(s)])}this.classList.remove(`${c}-pending`),this.classList.add(`${c}-initialized`)}async onConnect(){let t;if(this.src?t=(await import(this.src)).default:t=i.globalValue(this.name),!t){if(this.classList.add(`${c}-pending`),this.manual)return;i.watch(this.name,e=>{this.init(e)});return}this.init(t)}connectedCallback(){if(this.lazy){g.observe(this);return}this.onConnect()}};customElements.define("modular-behaviour",i);var m=i;export{m as default};
//# sourceMappingURL=modular-behaviour.min.js.map
