function p(i){if(i==="true")return!0;if(i==="false")return!1;if(i===""||i==="null")return null;if(i===Number(i).toString())return Number(i);if(i.indexOf("[")===0||i.indexOf("{")===0)try{return i.indexOf('"')===-1&&(i=i.replaceAll("'",'"')),JSON.parse(decodeURIComponent(i))}catch{return console.log("Failed to parse "+i),{}}return i}function l(i){if(!i)return null;if(i.includes(".")){let t=i.split("."),e=t[0],s=t[1],n=window[e];return n?(e==="$"||e==="jQuery")&&typeof window.jQuery.fn[s]<"u"?(u,r)=>{window.jQuery.fn[s].call(window.jQuery(u),r)}:n[s]||null:void 0}return window[i]||null}function m(i){try{return new new Proxy(i,{construct:()=>({})}),!0}catch{return!1}}function d(i){for(let[t,e]of Object.entries(i))if(e&&typeof e=="object"){let s=e.__fn;s?typeof s=="string"?i[t]=s.split(".").reduce((n,u)=>n[u],window):Array.isArray(s)&&(i[t]=new Function(s[0],s[1])):d(e)}return i}var a="modular-behaviour",b=0,o={},f=0,h=null,g=()=>{c.scanWatchList()||(f<100?f+=10:f+=100,f<2e3?h=setTimeout(g,f):(console.warn(`Unable to load ${c.watching().join(",")}`),o={},h=null))},w=new window.IntersectionObserver((i,t)=>{i.forEach(async e=>{e.isIntersecting&&(t.unobserve(e.target),e.target.onConnect())})});window.addEventListener("DOMContentLoaded",()=>{c.scanWatchList()});var c=class extends HTMLElement{constructor(){super(),b++}set name(t){this.setAttribute("name",t)}get name(){return this.getAttribute("name")}set selector(t){this.setAttribute("selector",t)}get selector(){return this.getAttribute("selector")}set func(t){this.setAttribute("func",t)}get func(){return this.getAttribute("func")}set config(t){this.setAttribute("config",t)}get config(){return this.getAttribute("config")}set src(t){this.setAttribute("src",t)}get src(){return this.getAttribute("src")}set manual(t){t?this.setAttribute("manual",""):this.removeAttribute("manual")}get manual(){return this.hasAttribute("manual")}set lazy(t){t?this.setAttribute("lazy",""):this.removeAttribute("lazy")}get lazy(){return this.hasAttribute("lazy")}loadConfigTemplate(t){let e=document.createElement("script");e.textContent=t.content.textContent,this.appendChild(e)}resolveConfig(t={}){this.config&&(t=l(this.config),t||(console.warn(`${this.config} is not available`),t={}),typeof t=="function"&&(t=t()));let e={...this.dataset};for(var s in e)t[s]=p(e[s]);return t}static watch(t,e){let s=document.querySelector(`script[provides="${t}"]`);if(s){let n=s.onload;s.onload=u=>{n&&n(u);let r=l(t);r&&e(r)};return}o[t]||(o[t]=[]),o[t].push(e),f=10,h||g()}static scanWatchList(){for(var t in o){let s=l(t);if(s){for(var e of o[t])e(s);delete o[t]}}return Object.keys(o).length?!1:(h&&(clearTimeout(h),h=null),!0)}static run(t){let e=l(t);return e?(document.querySelectorAll(`modular-behaviour[name="${t}"]`).forEach(s=>{s.classList.contains(`${a}-initialized`)||s.init(e)}),!0):!1}static watching(){return Object.keys(o)}init(t){let e=this.querySelector(`template.${a}-config`),s={};if(this.dataset.mbConfig){let r=JSON.parse(this.dataset.mbConfig)||{};s=d(r)}else if(e)if(this.config)this.loadConfigTemplate(e);else{let r=JSON.parse(e.content.textContent)||{};s=d(r)}let n=this.selector?this.querySelector(this.selector):this.firstElementChild;if(!n){console.warn("No element");return}if(n.hasAttribute("id")||n.setAttribute("id",`${a}-${b}`),this.func&&(t=l(this.func),!t)){console.warn(`${this.func} is not available`);return}if(m(t))this.inst=new t(n,this.resolveConfig(s));else{let r=Object.create(t.prototype||t);this.inst=t.apply(r,[n,this.resolveConfig(s)])}this.classList.remove(`${a}-pending`),this.classList.add(`${a}-initialized`),this.dispatchEvent(new CustomEvent("connected",{detail:this.inst}))}async onConnect(){let t;if(this.src?t=(await import(this.src)).default:t=l(this.name),!t){if(this.classList.add(`${a}-pending`),this.manual)return;c.watch(this.name,e=>{this.init(e)});return}this.init(t)}connectedCallback(){if(this.lazy){w.observe(this);return}setTimeout(()=>{this.onConnect()},0)}disconnectedCallback(){this.inst&&typeof this.inst.destroy=="function"&&this.inst.destroy(),this.dispatchEvent(new CustomEvent("disconnected",{detail:this.inst})),this.inst=null}};customElements.define("modular-behaviour",c);var v=c;export{v as default};
//# sourceMappingURL=modular-behaviour.min.js.map
